{{ if (eq .chezmoi.os "linux") -}}
#!/usr/bin/env bash
# SPDX-FileCopyrightText: 2025 Samuel Wu
#
# SPDX-License-Identifier: 0BSD

# shellcheck disable=SC1091
source /etc/os-release

case "$ID $ID_LIKE" in
*"debian"*)
  sudo mkdir -p /etc/apt/keyrings
  curl -fsSL https://repo.charm.sh/apt/gpg.key | sudo gpg --dearmor -o /etc/apt/keyrings/charm.gpg
  echo "deb [signed-by=/etc/apt/keyrings/charm.gpg] https://repo.charm.sh/apt/ * *" | sudo tee /etc/apt/sources.list.d/charm.list

  sudo apt update -y
  sudo apt upgrade -y

  {{ range .packages.linux -}}
  sudo apt install {{ . | quote }}
  {{ end -}}

  {{ range .packages.debian -}}
  sudo apt install {{ . | quote }}
  {{ end -}}
  ;;
*"arch"*)
  sudo pacman -Syu --noconfirm

  {{ range .packages.linux -}}
  sudo pacman -S --noconfirm --needed {{ . | quote }}
  {{ end -}}

  {{ range .packages.arch -}}
  sudo pacman -S --noconfirm --needed {{ . | quote }}
  {{ end -}}
  ;;
*"fedora"*)
  echo '[charm]
name=Charm
baseurl=https://repo.charm.sh/yum/
enabled=1
gpgcheck=1
gpgkey=https://repo.charm.sh/yum/gpg.key' | sudo tee /etc/yum.repos.d/charm.repo

  sudo dnf upgrade -y

  {{ range .packages.linux -}}
  sudo dnf install -y {{ . | quote }}
  {{ end -}}

  {{ range .packages.fedora -}}
  sudo dnf install -y {{ . | quote }}
  {{ end -}}
  ;;
*"nixos"*)
  printf "NixOS is not supported by this script.\n"
  printf "However, the 'wsixor' repository contains an equivalent configuration.\n"
  exit
  ;;
*)
  printf >&2 "Sorry your distribution is not supported by this script.\n"
  printf >&2 "Please create an issue or pull request to add your distribution.\n"
  exit 1
  ;;
esac

{{ end -}}
